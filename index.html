<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8">
  <title>Kalorijski kalkulator</title>

  <!-- BARCODE LIBRARY -->
  <script src="https://unpkg.com/@ericblade/quagga2/dist/quagga.js"></script>

  <style>
    * { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }

    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #43cea2, #185a9d);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .page {
      display: none;
      width: 380px;
      padding: 25px;
      border-radius: 18px;
      background: #fff;
      box-shadow: 0 20px 50px rgba(0,0,0,0.3);
      text-align: center;
    }

    h1, h2 { margin-bottom: 10px; }

    label {
      display: block;
      margin-top: 10px;
      font-size: 14px;
      text-align: left;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      width: 100%;
      margin-top: 15px;
      padding: 12px;
      border: none;
      border-radius: 12px;
      background: #185a9d;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover { background: #144a82; }

    .result {
      margin-top: 15px;
      padding: 12px;
      background: #f4f6f8;
      border-radius: 10px;
      white-space: pre-line;
    }

    #scanner video {
      width: 100%;
      border-radius: 12px;
      margin-top: 10px;
    }
  </style>
</head>

<body>

<!-- LANDING -->
<div class="page" id="landingPage" style="display:block;">
  <h1>üî• Kalorijski kalkulator</h1>
  <button onclick="goMenu()">Nastavi</button>
</div>

<!-- MENU -->
<div class="page" id="menuPage">
  <h2>Odaberi opciju</h2>
  <button onclick="openFood()">ü•ó Kalorije u hrani</button>
  <button onclick="openPerson()">üßç‚Äç‚ôÇÔ∏è Kalorije za osobu</button>
</div>

<!-- PERSON CALCULATOR -->
<div class="page" id="personPage">
  <h2>Kalorije za osobu</h2>

  <label>Spol</label>
  <select id="gender">
    <option value="male">Mu≈°ko</option>
    <option value="female">≈Ωensko</option>
  </select>

  <label>Godine</label>
  <input type="number" id="age">

  <label>Visina (cm)</label>
  <input type="number" id="height">

  <label>Te≈æina (kg)</label>
  <input type="number" id="weight">

  <label>Aktivnost</label>
  <select id="activity">
    <option value="1.2">Sjedilaƒçki</option>
    <option value="1.375">Lagana</option>
    <option value="1.55">Umjerena</option>
    <option value="1.725">Visoka</option>
  </select>

  <button onclick="calculatePerson()">Izraƒçunaj</button>

  <div class="result" id="personResult"></div>
  <button onclick="goMenu()">‚¨Ö Nazad</button>
</div>

<!-- FOOD + BARCODE -->
<div class="page" id="foodPage">
  <h2>Kalorije u hrani</h2>

  <button onclick="startScanner()">üì∑ Skeniraj barkod</button>

  <div id="scanner"></div>

  <label>Proizvod</label>
  <input type="text" id="productName" readonly>

  <label>Kalorije (100g)</label>
  <input type="number" id="kcal100" readonly>

  <label>Koliƒçina (g)</label>
  <input type="number" id="grams">

  <button onclick="calculateFood()">Izraƒçunaj</button>

  <div class="result" id="foodResult"></div>
  <button onclick="goMenu()">‚¨Ö Nazad</button>
</div>

<script>
function hideAll() {
  document.querySelectorAll(".page").forEach(p => p.style.display = "none");
}

function goMenu() {
  hideAll();
  document.getElementById("menuPage").style.display = "block";
}

function openPerson() {
  hideAll();
  document.getElementById("personPage").style.display = "block";
}

function openFood() {
  hideAll();
  document.getElementById("foodPage").style.display = "block";
}

function calculatePerson() {
  var g = gender.value;
  var a = +age.value;
  var h = +height.value;
  var w = +weight.value;
  var act = +activity.value;

  if (!a || !h || !w) {
    personResult.innerText = "Unesi sve podatke.";
    return;
  }

  var bmr = g === "male"
    ? (10*w + 6.25*h - 5*a + 5)
    : (10*w + 6.25*h - 5*a - 161);

  var tdee = Math.round(bmr * act);

  personResult.innerText =
    "üî• Odr≈æavanje: " + tdee + " kcal\n" +
    "‚¨áÔ∏è Mr≈°avljenje: " + (tdee - 500) + " kcal\n" +
    "‚¨ÜÔ∏è Masa: " + (tdee + 300) + " kcal";
}

/* BARCODE */
function startScanner() {
  document.getElementById("scanner").innerHTML = "";
  Quagga.init({
    inputStream: {
      type: "LiveStream",
      target: document.querySelector("#scanner"),
      constraints: { facingMode: "environment" }
    },
    decoder: {
      readers: ["ean_reader", "ean_8_reader", "upc_reader"]
    }
  }, err => {
    if (err) return alert("Gre≈°ka s kamerom");
    Quagga.start();
  });

  Quagga.onDetected(data => {
    Quagga.stop();
    fetchProduct(data.codeResult.code);
  });
}

function fetchProduct(code) {
  fetch("https://world.openfoodfacts.org/api/v0/product/" + code + ".json")
    .then(res => res.json())
    .then(data => {
      if (data.status !== 1) {
        foodResult.innerText = "Proizvod nije pronaƒëen.";
        return;
      }

      var p = data.product;
      var kcal = p.nutriments["energy-kcal_100g"];

      productName.value = p.product_name || "Nepoznat proizvod";
      kcal100.value = kcal || "";

      if (!kcal) {
        foodResult.innerText = "Nema podataka o kalorijama.";
      }
    });
}

function calculateFood() {
  var kcal = +kcal100.value;
  var g = +grams.value;

  if (!kcal || !g) {
    foodResult.innerText = "Unesi koliƒçinu.";
    return;
  }

  foodResult.innerText =
    "üî• Ukupno kalorija: " + Math.round(kcal / 100 * g) + " kcal";
}
</script>

</body>
</html>
